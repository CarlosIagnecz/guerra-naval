<html>
	<head>
		<title>Batalha Naval</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>		<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
		<style>
			td{
				height: 80px;
				width: 80px;
				border: solid black 4px;
			}
			td.P1 {
				background: #FFAAAA;
			}
			td.P1.Miss {
				background: #FF0000;
			}
			td.P1.Barco.Show {
				background: #FFDDDD;
			}
			
			td.P1:hover {
				box-shadow: inset 0 0 10px #880000AA !important;
			}
			
			td.P2:hover{
				box-shadow: inset 0 0 10px #000088AA !important;
			}
			
			td.P2 {
				background: #AAAAFF;
			}
			td.P2.Miss {
				background: #0000FF;
			}
			td.P2.Barco.Show {
				background: #DDDDFF;
			}
			@keyframes giveUpAnim {
				from {left: 0%; top: 0%}
				to {left: 200%; top: 200%}
			}
			.giveUp {
				position: relative;
				animation-name: giveUpAnim;
				animation-duration: 1s;
				left: 200%;
				top: 200%;
			}
			#turno, #menu {
				margin-top: 3%
				
			}
			.win {
				float: left;
				padding: 5px;
				margin-left: 7.75%;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div id="inicio" class="mt-5 text-center">
				<h1>Bem vindo à Batalha Naval</h1>
				<h5 class="text-start">Quantidade de Barcos</h5>
				<select class="form-select" id="qtd-barcos" aria-label="qtd-barcos">
				  <option selected>Quantidade de Barcos</option>
				  <option value="1">Um</option>
				  <option value="2">Dois</option>
				  <option value="3">Três</option>
				  <option value="4">Quatro</option>
				  <option value="5">Cinco</option>
				  <option value="6">Seis</option>
				</select>
				<button onclick="init()" class="btn btn-primary mt-1">Jogar</button>
			</div>
			<div class="d-none text-center" id="titulo">
				<h4 id="mensagem">Jogador 1 informe onde deseja colocar seus navios</h4>
				<h6>Navios restantes: <span id="counter"></span></h6>
			</div>
			<div class="d-none text-center" id="p1">
				<table class="mx-auto">
					<tbody>
						<tr>
							<td id="00" class="P1 Show">
							<td id="01" class="P1 Show">
							<td id="02" class="P1 Show">
							<td id="03" class="P1 Show">
							<td id="04" class="P1 Show">
							<td id="05" class="P1 Show"></td>
						<tr>
							<td id="10" class="P1 Show">
							<td id="11" class="P1 Show">
							<td id="12" class="P1 Show">
							<td id="13" class="P1 Show">
							<td id="14" class="P1 Show">
							<td id="15" class="P1 Show"></td>
						<tr>
							<td id="20" class="P1 Show">
							<td id="21" class="P1 Show">
							<td id="22" class="P1 Show">
							<td id="23" class="P1 Show">
							<td id="24" class="P1 Show">
							<td id="25" class="P1 Show"></td>
						<tr>
						<tr>
							<td id="30" class="P1 Show">
							<td id="31" class="P1 Show">
							<td id="32" class="P1 Show">
							<td id="33" class="P1 Show">
							<td id="34" class="P1 Show">
							<td id="35" class="P1 Show"></td>
						<tr>
							<td id="40" class="P1 Show">
							<td id="41" class="P1 Show">
							<td id="42" class="P1 Show">
							<td id="43" class="P1 Show">
							<td id="44" class="P1 Show">
							<td id="45" class="P1 Show"></td>
						<tr>
							<td id="50" class="P1 Show">
							<td id="51" class="P1 Show">
							<td id="52" class="P1 Show">
							<td id="53" class="P1 Show">
							<td id="54" class="P1 Show">
							<td id="55" class="P1 Show"></td>
						</tr>
					</tbody>
				</table>
			</div>
			<div class="d-none text-center" id="p2">
				<table class="mx-auto">
					<tbody>
						<tr>
							<td id="00" class="P2 Show">
							<td id="01" class="P2 Show">
							<td id="02" class="P2 Show">
							<td id="03" class="P2 Show">
							<td id="04" class="P2 Show">
							<td id="05" class="P2 Show"></td>
						<tr>
							<td id="10" class="P2 Show">
							<td id="11" class="P2 Show">
							<td id="12" class="P2 Show">
							<td id="13" class="P2 Show">
							<td id="14" class="P2 Show">
							<td id="15" class="P2 Show"></td>
						<tr>
							<td id="20" class="P2 Show">
							<td id="21" class="P2 Show">
							<td id="22" class="P2 Show">
							<td id="23" class="P2 Show">
							<td id="24" class="P2 Show">
							<td id="25" class="P2 Show"></td>
						<tr>
						<tr>
							<td id="30" class="P2 Show">
							<td id="31" class="P2 Show">
							<td id="32" class="P2 Show">
							<td id="33" class="P2 Show">
							<td id="34" class="P2 Show">
							<td id="35" class="P2 Show"></td>
						<tr>
							<td id="40" class="P2 Show">
							<td id="41" class="P2 Show">
							<td id="42" class="P2 Show">
							<td id="43" class="P2 Show">
							<td id="44" class="P2 Show">
							<td id="45" class="P2 Show"></td>
						<tr>
							<td id="50" class="P2 Show">
							<td id="51" class="P2 Show">
							<td id="52" class="P2 Show">
							<td id="53" class="P2 Show">
							<td id="54" class="P2 Show">
							<td id="55" class="P2 Show"></td>
						</tr>
					</tbody>
				</table>
			</div>
			
			<div class="text-center">
				<button class="btn btn-danger d-none" onclick="passTurn()" id="turno">Passar Turno</button>
				<button class="btn btn-dark d-none" ondblclick="back2menu()" id="menu">De volta para o menu</button>
			</div>
			
		</div>
		<script>
			let barcosGlobal
			let barcosP1
			let barcosP2
			let player
			let patience = 10
			let turn = false
			let win = 0
			function init(){
				if (patience<0) {
					alert("Morri")
					$("#inicio").remove()
					return 0
				}
				if ($("#qtd-barcos").val() == 'Quantidade de Barcos') {
					alert("Selecione a quantidade de barcos antes de jogar.");
					patience--;
					if (patience<0) {
						alert("Eu desisto");
						$("#inicio").addClass("giveUp");
					}
				} else {
					startup();
				}
			}
			function showP1(show) {
				$("#p1").removeClass("d-none");
				$("#p2").addClass("d-none");
				if (show) {
					$("#counter").text(barcosP1);
				}
			}
			
			function showP2(show) {
				$("#p1").addClass("d-none");
				$("#p2").removeClass("d-none");
				if (show) {
					$("#counter").text(barcosP2);
				}
			}
			
			function configMain() {
				barcosP1 = barcosGlobal;
				barcosP2 = barcosGlobal;
				player = 1;
			}
			
			function startup() {
				barcosGlobal = $("#qtd-barcos").val()
				$("#counter").text(barcosP1);
				configMain()
				$("#inicio").addClass("d-none");
				$("#p1, #titulo, #menu").removeClass("d-none");
			}
			
			$("td.P1, td.P2").click(setBarco);
			
			function setBarco(){
				if ($(this).hasClass("Barco")) {
					return 0;
				}
				$(this).addClass("Barco");
				plotBarco();
			}
			function plotBarco() {
				if (player == 1) {
					barcosP1--;
					$("#counter").text(barcosP1);
					if (barcosP1==0) {
						$("#mensagem").text("Jogador 2 informe onde deseja colocar seus navios");
						$("#counter").text(barcosP2);
						player = 2;
						$("#p1").addClass("d-none");
						$("#p2").removeClass("d-none");
						barcosP1--;
					}
				} else {
					barcosP2--;
					$("#counter").text(barcosP2);
					if (barcosP2==0) {
						$("#mensagem").text("Jogador 1 atire em um quadro");
						$("td.P1, td.P2").off("click");
						$("td.P1, td.P2").removeClass("Show");
						barcosP2--;
						configMain();
						$("#turno").removeClass("d-none");
						turn = false;
						showP2(true);
						$("td.P1, td.P2").click(shoot);
					}
				}
			}
			
			function winProcess() {
				$("#p1,#p2").removeClass("text-center");
				$("#p1").addClass("win");
				$("td.P1,td.P2").addClass("Show");
				$("#turno").addClass("d-none");
				
			}
			function shoot() {
				if (win>0) {
					alert("O jogo já acabou!")
					return 0
				}
				if ($(this).hasClass("Show")) {
					alert("Esse navio já foi derrubado!")
					return 0
				}
				if (turn) {
					alert("Você já jogou!")
					return 0
				}
				if ($(this).hasClass("Barco")) {
					$(this).addClass("Show")
					if (player == 1) {
						barcosP2--;
						$("#counter").text(barcosP2);
						if (barcosP2==0) {
							win = 1;
							$("#mensagem").text("Jogador 1 venceu!");
							$("#p1").removeClass("d-none");
							winProcess();
						}
					} else {
						barcosP1--;
						$("#counter").text(barcosP1);
						if (barcosP1==0) {
							win = 2;
							$("#mensagem").text("Jogador 2 venceu!");
							$("#p2").removeClass("d-none");
							winProcess();
						}
					}
				} else {
					$(this).addClass("Miss")
				}
				
				turn = (win==0)
			}
			function passTurn() {
				if (turn==false) {
					alert("Você ainda não jogou!")
					return 0
				}
				if (player == 1) {
					$("#mensagem").text("Jogador 2 atire em um quadro");
					showP1(true);
				} else {
					$("#mensagem").text("Jogador 1 atire em um quadro");
					showP2(true);
				}
				
				player = 3 - player;
				
				turn = false
			}
			
			function back2menu() {
				configMain()
				$("#inicio").removeClass("d-none");
				$("#p1,#p2,#turno,#menu,#titulo").addClass("d-none");
				$("#p1").removeClass("win");
				$("td.P1,td.P2").removeClass("Miss , Barco");
				$("td.P1,td.P2").addClass("Show");
				win=0;
				patience=10;
				$("td.P1, td.P2").off("click");
				$("td.P1, td.P2").click(setBarco);
				$("#mensagem").text("Jogador 1 informe onde deseja colocar seus navios");
				$("#p1,#p2").addClass("text-center")
				
			}
		</script>